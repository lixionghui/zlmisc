
# 第二代居民身份证号码检验是否符合规范的函数
# 18位身份证号码

#### 定义验证函数 ####
idno_verify <- function(x){
  
  
  # 身份证号码
  # 理论上为字符串，部分情况有X这个字符（这里的X实际上是数字10的罗马写法）
  
  # x <- c("45102519810711316X") # 定义函数过程中的测试数据
  # 
  # nchar(x)
  
  
  
  # 如果值为数字，可将其转为为字符
  # x <- as.character(45102519810711316X)
  
  # 将身份证号码拆分成18个字符向量
  id_str <- substring(x, 1:18, 1:18)
  
  
  # 身份证号码前17位数字（向量）
  # 字符转化为数字，需要用来做数学运算
  id17 <- as.numeric(id_str[-18])
  
  # 身份证号码第18位数字
  id_18 <- id_str[18]
  
  # 前17个数字的权重系数：2的幂
  w <- 2^(17:1)
  
  # 前17个数字的权重和的余数
  remainder <- sum(id17 * w) %% 11
  
  
  # 余数列表
  # 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10
  # 校验码对照表
  # 1, 0, X, 9, 8, 7, 6, 5, 4, 3, 2
  
  # X 是字符，这个向量都会转化为字符
  check_code <- c(1, 0, "X", 9, 8, 7, 6, 5, 4, 3, 2)
  
  # 校验省份证号码第18位（数字），是否与计算余数后对应的校验码是否相等
  return(id_18 == check_code[remainder+1])
  
  
}

#### 测试数据 向量 ####
y <- c("511702197404273000",
       "511702197108242000",
       "511702197001181000",
       "511702198708178000",
       "511702197008221000",
       "522635198206279000",
       "522635198807185000",
       "522635198005272000",
       "522635197604188000",
       "522635197801141000",
       "53262819820314783X",
       "532628197907137000",
       "532628197407119000",
       "532628197108158000",
       "532628198504287000",
       "411525197604165000",
       "411525198309256000",
       "411525198001199000",
       "411525198106127000",
       "411525198609255000",
       "120000197105236000",
       "12000019820110541X",
       "120000197207182000",
       "120000198603236000",
       "120000197101106000",
       "522635198708184000",
       "52263519830114890X",
       "522635198001259000",
       "522635197809122000",
       "522635197608189000",
       "451025197408122000",
       "451025198607117000",
       "451025197308146000",
       "45102519810711316X",
       "451025197501107000",
       "451025197909152000",
       "451025198807243000",
       "451025197108189000",
       "451025198909222000",
       "451025198004124000",
       "532628198206109000",
       "532628197903253000",
       "53262819720718326X",
       "532628198605112000",
       "532628198109243000",
       "411525198009274000",
       "411525198306153000",
       "411525198902231000",
       "411525197206189000",
       "411525198407154000"
       )


#### 应用函数 sapply ####
sapply(y, idno_verify, USE.NAMES = FALSE)
